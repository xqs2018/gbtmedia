import{B as q,s as S}from"./gbt28181-C3wyvrue.js";import{h as T}from"./moment-C5S46NFB.js";import{F as A}from"./FlvPlayerModal-CXw7H9j7.js";import{d as G,r as i,j as J,b as z,e as K,c as t,w as n,f as m,F,h as p,y as P,t as O,z as Q,i as V,o as h,_ as W}from"./index-BYlyECpH.js";import"./request-xFzgdMuq.js";const X={class:"search-form",style:{"margin-bottom":"16px"}},Z=G({__name:"InviteView",setup(ee){const u=i({deviceId:"",channelId:""}),k=()=>{l.value.current=1,c(l.value.current,l.value.pageSize)},Y=()=>{u.value={deviceId:"",channelId:""},k()},R=[{title:"创建时间",dataIndex:"createTime",key:"createTime",customRender:a=>T(a.value).format("YYYY-MM-DD HH:mm:ss")},{title:"类型",dataIndex:"inviteType",key:"inviteType"},{title:"设备ID",dataIndex:"deviceId",key:"deviceId"},{title:"通道ID",dataIndex:"channelId",key:"channelId"},{title:"播放地址",dataIndex:"httpFlv",key:"httpFlv"},{title:"接收速率",dataIndex:"rxRate",key:"rxRate"},{title:"扩展信息",dataIndex:"extInfo",key:"extInfo"},{title:"操作",key:"action",fixed:"right",width:350}],_=i([]),l=i({current:1,pageSize:10,total:0}),C=i(!1),c=async(a,e)=>{try{const o={pageNo:a-1,pageSize:e,deviceId:u.value.deviceId,channelId:u.value.channelId},v=await q(o);_.value=v.data.map(r=>({...r,loading:!1})),l.value.total=v.data.length,l.value.current=a}catch(o){console.error("获取数据失败:",o)}finally{C.value=!1}},M=a=>{const{current:e,pageSize:o}=a;c(e,o)};J(()=>{c(l.value.current,l.value.pageSize)});const f=i(!1),b=i(""),g=i(!1),U=async a=>{g.value=!0;try{b.value=a.httpFlv,f.value=!0}catch(e){console.log(e)}finally{g.value=!1}},B=async a=>{a.loading=!0;try{const e=await S({callId:a.callId});V.success(e.message),await c(l.value.current,l.value.pageSize)}catch(e){console.log(e)}finally{a.loading=!1}},y=i(!1),N=[{title:"创建时间",dataIndex:"createTime",key:"createTime",customRender:a=>T(a.value).format("YYYY-MM-DD HH:mm:ss")},{title:"上级平台ID",dataIndex:"platformId",key:"platformId"},{title:"发送速率",dataIndex:"txRate",key:"txRate"},{title:"操作",key:"action"}],I=i([]),D=i({current:1,pageSize:10,total:0}),H=a=>{y.value=!0,I.value=a.platformInvites.map(e=>({...e,loading:!1})),D.value=a.platformInvites.length},$=async a=>{a.loading=!0;try{const e=await S({callId:a.callId});V.success(e.message),I.value=I.value.filter(o=>o.callId!=a.callId),await c(l.value.current,l.value.pageSize)}catch(e){console.log(e)}finally{a.loading=!1}},L=()=>{c(l.value.current,l.value.pageSize),y.value=!1};return(a,e)=>{const o=m("a-input"),v=m("a-form-item"),r=m("a-button"),j=m("a-form"),w=m("a-table"),E=m("a-modal");return h(),z(F,null,[K("div",X,[t(j,{layout:"inline"},{default:n(()=>[t(v,{label:"设备ID"},{default:n(()=>[t(o,{value:u.value.deviceId,"onUpdate:value":e[0]||(e[0]=s=>u.value.deviceId=s),placeholder:"请输入设备ID",allowClear:""},null,8,["value"])]),_:1}),t(v,{label:"通道ID"},{default:n(()=>[t(o,{value:u.value.channelId,"onUpdate:value":e[1]||(e[1]=s=>u.value.channelId=s),placeholder:"请输入通道ID",allowClear:""},null,8,["value"])]),_:1}),t(v,null,{default:n(()=>[t(r,{onClick:k},{default:n(()=>e[4]||(e[4]=[p("查询")])),_:1}),t(r,{style:{"margin-left":"8px"},onClick:Y},{default:n(()=>e[5]||(e[5]=[p("重置")])),_:1})]),_:1})]),_:1})]),t(w,{columns:R,"data-source":_.value,pagination:l.value,onChange:M,loading:C.value,scroll:{x:"max-content"}},{bodyCell:n(({column:s,record:d})=>[s.key==="action"?(h(),z(F,{key:0},[t(r,{onClick:x=>U(d),style:{"margin-right":"10px"},loading:g.value},{default:n(()=>e[6]||(e[6]=[p("Play")])),_:2},1032,["onClick","loading"]),t(r,{onClick:x=>H(d),style:{"margin-right":"10px"}},{default:n(()=>[p("级联推流["+O(d.platformInvites.length)+"]",1)]),_:2},1032,["onClick"]),t(r,{danger:"",onClick:x=>B(d),style:{"margin-right":"10px"},loading:d.loading},{default:n(()=>e[7]||(e[7]=[p("停止")])),_:2},1032,["onClick","loading"])],64)):P("",!0)]),_:1},8,["data-source","pagination","loading"]),t(A,{visible:f.value,flvUrl:b.value,onCancel:e[2]||(e[2]=()=>f.value=!1),"onUpdate:visible":e[3]||(e[3]=s=>f.value=s)},null,8,["visible","flvUrl"]),t(E,{visible:y.value,title:"级联推流",onCancel:L,footer:null,width:"780px"},{default:n(()=>[t(w,{columns:N,"data-source":I.value,pagination:D.value},{bodyCell:n(({column:s,record:d})=>[s.key==="action"?(h(),Q(r,{key:0,danger:"",onClick:x=>$(d),style:{"margin-right":"12px"},loading:d.loading},{default:n(()=>e[8]||(e[8]=[p("停止")])),_:2},1032,["onClick","loading"])):P("",!0)]),_:1},8,["data-source","pagination"])]),_:1},8,["visible"])],64)}}}),ie=W(Z,[["__scopeId","data-v-5fb54814"]]);export{ie as default};
