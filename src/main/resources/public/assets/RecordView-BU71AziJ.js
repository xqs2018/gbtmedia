import{r as M,m as P}from"./gbt28181-C3wyvrue.js";import{d as j,r,j as A,b as y,e as x,c as t,w as n,f as c,i as h,h as g,y as C,F as E,g as L,o as b}from"./index-BYlyECpH.js";import"./request-xFzgdMuq.js";const q={class:"search-container",style:{"margin-bottom":"16px"}},G=["href","download"],H=["src"],W=j({__name:"RecordView",setup(J){const i=r({deviceId:"",channelId:""}),N=[{title:"设备ID",dataIndex:"deviceId",key:"deviceId"},{title:"通道ID",dataIndex:"channelId",key:"channelId"},{title:"开始时间",dataIndex:"startTime",key:"startTime"},{title:"结束时间",dataIndex:"endTime",key:"endTime"},{title:"录像类型",dataIndex:"type",key:"type",customRender:({text:a})=>a===1?"设备":a===2?"云端":a},{title:"文件大小",dataIndex:"fileSize",key:"fileSize"},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"操作",key:"action",fixed:"right",width:350}],k=r([]),I=r(!1),l=r({current:1,pageSize:10,total:0}),w=`${window.location.protocol}//${window.location.host}/`.replace(/\/$/,""),v=async(a,e)=>{I.value=!0;try{const o={pageNo:a-1,pageSize:e,deviceId:i.value.deviceId,channelId:i.value.channelId},s=await M(o);k.value=s.data.map(u=>({...u,loading:!1})),l.value.total=s.data.length,l.value.current=a}catch(o){console.error("获取数据失败:",o),h.error("获取数据失败")}finally{I.value=!1}},$=a=>{const{current:e,pageSize:o}=a;v(e,o)},D=async a=>{a.loading=!0;try{const e=await P({fileName:a.fileName});h.success("删除成功"),await v(l.value.current,l.value.pageSize)}catch(e){console.error("删除失败:",e),h.error("删除失败")}finally{a.loading=!1}},p=r(!1),f=r(""),_=r(""),S=a=>{f.value=`${w}/backend/gbt28181/downloadRecordFile/${a.fileName}`,_.value=a.fileName,p.value=!0},T=()=>{p.value=!1,f.value="",_.value=""},V=()=>{l.value.current=1,v(l.value.current,l.value.pageSize)},z=()=>{i.value={deviceId:"",channelId:""},l.value.current=1,v(l.value.current,l.value.pageSize)};return A(()=>{v(l.value.current,l.value.pageSize)}),(a,e)=>{const o=c("a-input"),s=c("a-form-item"),u=c("a-button"),F=c("a-form"),R=c("a-table"),U=c("a-modal");return b(),y("div",null,[x("div",q,[t(F,{layout:"inline"},{default:n(()=>[t(s,{label:"设备ID"},{default:n(()=>[t(o,{value:i.value.deviceId,"onUpdate:value":e[0]||(e[0]=d=>i.value.deviceId=d),placeholder:"请输入设备ID",allowClear:""},null,8,["value"])]),_:1}),t(s,{label:"通道ID"},{default:n(()=>[t(o,{value:i.value.channelId,"onUpdate:value":e[1]||(e[1]=d=>i.value.channelId=d),placeholder:"请输入通道ID",allowClear:""},null,8,["value"])]),_:1}),t(s,null,{default:n(()=>[t(u,{onClick:V},{default:n(()=>e[3]||(e[3]=[g("查询")])),_:1}),t(u,{style:{"margin-left":"8px"},onClick:z},{default:n(()=>e[4]||(e[4]=[g("重置")])),_:1})]),_:1})]),_:1})]),t(R,{columns:N,"data-source":k.value,pagination:l.value,onChange:$,loading:I.value,scroll:{x:"max-content"}},{bodyCell:n(({column:d,record:m})=>[d.key==="action"?(b(),y(E,{key:0},[x("a",{href:`${L(w)}/backend/gbt28181/downloadRecordFile/${m.fileName}`,style:{"margin-right":"10px"},download:m.fileName},"下载",8,G),t(u,{onClick:B=>S(m),style:{"margin-right":"10px"}},{default:n(()=>e[5]||(e[5]=[g("播放")])),_:2},1032,["onClick"]),t(u,{danger:"",onClick:B=>D(m),loading:m.loading},{default:n(()=>e[6]||(e[6]=[g("删除")])),_:2},1032,["onClick","loading"])],64)):C("",!0)]),_:1},8,["data-source","pagination","loading"]),t(U,{visible:p.value,"onUpdate:visible":e[2]||(e[2]=d=>p.value=d),title:`在线播放 - ${_.value}`,footer:null,width:"800px",onCancel:T},{default:n(()=>[f.value?(b(),y("video",{key:0,src:f.value,controls:"",muted:"",style:{width:"100%"}},null,8,H)):C("",!0)]),_:1},8,["visible","title"])])}}});export{W as default};
