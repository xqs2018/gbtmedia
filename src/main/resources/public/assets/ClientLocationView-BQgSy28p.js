import{a as j}from"./jtt808-PzOwMx6L.js";import{d as H,G as L,r as n,j as E,C as U,b as p,c as o,w as l,f as c,g as P,h as x,z as N,y as k,F as $,e as _,t as Y,p as W,o as s,_ as q}from"./index-BYlyECpH.js";import{l as G}from"./zh_CN-CIeKJixd.js";import"./request-xFzgdMuq.js";const J=["href"],K={class:"ellipsis-text"},O={class:"media-container"},Q={class:"media-content"},X=["src"],Z=["src"],ee={class:"filename"},ae=["href"],te=H({__name:"ClientLocationView",setup(le){L.locale("zh-cn");const B=[{title:"终端手机号",dataIndex:"clientId",key:"clientId"},{title:"纬度",dataIndex:"latitude",key:"latitude"},{title:"经度",dataIndex:"longitude",key:"longitude"},{title:"速度",dataIndex:"speed",key:"speed"},{title:"状态标志",dataIndex:"statusBitName",key:"statusBitName",width:200},{title:"报警标志",dataIndex:"warnBitName",key:"warnBitName",width:200},{title:"苏标报警",dataIndex:"alarmName",key:"alarmName"},{title:"设备时间",dataIndex:"deviceTime",key:"deviceTime"},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"操作",key:"action",fixed:"right",width:350}],w=n([]),t=n({current:1,pageSize:10,total:0}),y=n(!1),u=n({dateRange:[]}),F=()=>{f(t.value.current,t.value.pageSize)},T=()=>{u.value={dateRange:[]},f(t.value.current,t.value.pageSize)},f=async(i,a)=>{var m,v;try{y.value=!0;const d={pageNo:i-1,pageSize:a,clientId:I.value,startTime:(m=u.value.dateRange[0])==null?void 0:m.format("YYYY-MM-DD HH:mm:ss"),endTime:(v=u.value.dateRange[1])==null?void 0:v.format("YYYY-MM-DD HH:mm:ss")},g=await j(d);w.value=g.data.content,t.value.total=g.data.page.totalElements,t.value.current=i}catch(d){console.error("获取数据失败:",d)}finally{y.value=!1}},D=i=>{const{current:a,pageSize:m}=i;f(a,m)},R=U(),I=n("");E(()=>{I.value=R.query.clientId,f(t.value.current,t.value.pageSize)});const h=n(!1),C=n([]),S=i=>{C.value=i.alarmFileName.split(","),h.value=!0},V=`${window.location.protocol}//${window.location.host}/`.replace(/\/$/,""),b=n(V);return(i,a)=>{const m=c("a-range-picker"),v=c("a-form-item"),d=c("a-button"),g=c("a-form"),z=c("a-tooltip"),A=c("a-table"),M=c("a-modal");return s(),p("div",null,[o(g,{layout:"inline",model:u.value,class:"search-form",style:{"margin-bottom":"16px"}},{default:l(()=>[o(v,{label:"时间范围"},{default:l(()=>[o(m,{value:u.value.dateRange,"onUpdate:value":a[0]||(a[0]=e=>u.value.dateRange=e),placeholder:["开始时间","结束时间"],locale:P(G),"show-time":"",format:"YYYY-MM-DD HH:mm:ss"},null,8,["value","locale"])]),_:1}),o(v,null,{default:l(()=>[o(d,{onClick:F},{default:l(()=>a[2]||(a[2]=[x("查询")])),_:1}),o(d,{style:{"margin-left":"8px"},onClick:T},{default:l(()=>a[3]||(a[3]=[x("重置")])),_:1})]),_:1})]),_:1},8,["model"]),o(A,{columns:B,"data-source":w.value,pagination:t.value,onChange:D,loading:y.value,scroll:{x:"max-content"}},{bodyCell:l(({column:e,record:r})=>[e.key==="action"?(s(),p($,{key:0},[_("a",{href:`https://uri.amap.com/marker?position=${r.longitude/1e6},${r.latitude/1e6}`,target:"_blank"},"定位",8,J),r.alarmName?(s(),N(d,{key:0,onClick:oe=>S(r),style:{"margin-left":"12px"},loading:r.loading},{default:l(()=>a[4]||(a[4]=[x("报警附件")])),_:2},1032,["onClick","loading"])):k("",!0)],64)):e.key==="statusBitName"||e.key==="warnBitName"?(s(),N(z,{key:1,title:r[e.key]},{default:l(()=>[_("span",K,Y(r[e.key]),1)]),_:2},1032,["title"])):k("",!0)]),_:1},8,["data-source","pagination","loading"]),o(M,{visible:h.value,title:"报警附件",onCancel:a[1]||(a[1]=()=>h.value=!1),footer:null,width:"780px"},{default:l(()=>[_("div",O,[(s(!0),p($,null,W(C.value,e=>(s(),p("div",{key:e,class:"media-item"},[_("div",Q,[e.endsWith("jpg")?(s(),p("img",{key:0,src:`${b.value}/backend/jtt808/downloadAlarmFile/${e}`,alt:""},null,8,X)):k("",!0),e.endsWith("mp4")?(s(),p("video",{key:1,src:`${b.value}/backend/jtt808/downloadAlarmFile/${e}`,alt:""},null,8,Z)):k("",!0)]),_("div",ee,[_("a",{href:`${b.value}/backend/jtt808/downloadAlarmFile/${e}`,target:"_blank",style:{color:"black"}},Y(e),9,ae)])]))),128))])]),_:1},8,["visible"])])}}}),ce=q(te,[["__scopeId","data-v-314db801"]]);export{ce as default};
