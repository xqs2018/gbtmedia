import{i as Ee,l as fe}from"./jtt808-PzOwMx6L.js";import{B as xe,A as J,d as Ne,r as C,H as pe,j as Re,k as Pe,b as De,e as M,c as N,w as B,f as z,h as ve,t as k,i as me,q as Ge,x as $e,o as Be,_ as ze}from"./index-BYlyECpH.js";import"./request-xFzgdMuq.js";var K={exports:{}},Fe=K.exports,ge;function Ve(){return ge||(ge=1,function(d,l){(function(f,m){d.exports=m()})(Fe,function(){function f(e){var g=[];return e.AMapUI&&g.push(m(e.AMapUI)),e.Loca&&g.push(v(e.Loca)),Promise.all(g)}function m(e){return new Promise(function(g,u){var s=[];if(e.plugins)for(var c=0;c<e.plugins.length;c+=1)a.AMapUI.plugins.indexOf(e.plugins[c])==-1&&s.push(e.plugins[c]);if(n.AMapUI===i.failed)u("前次请求 AMapUI 失败");else if(n.AMapUI===i.notload){n.AMapUI=i.loading,a.AMapUI.version=e.version||a.AMapUI.version,c=a.AMapUI.version;var _=document.body||document.head,w=document.createElement("script");w.type="text/javascript",w.src="https://webapi.amap.com/ui/"+c+"/main.js",w.onerror=function(p){n.AMapUI=i.failed,u("请求 AMapUI 失败")},w.onload=function(){if(n.AMapUI=i.loaded,s.length)window.AMapUI.loadUI(s,function(){for(var p=0,y=s.length;p<y;p++){var j=s[p].split("/").slice(-1)[0];window.AMapUI[j]=arguments[p]}for(g();b.AMapUI.length;)b.AMapUI.splice(0,1)[0]()});else for(g();b.AMapUI.length;)b.AMapUI.splice(0,1)[0]()},_.appendChild(w)}else n.AMapUI===i.loaded?e.version&&e.version!==a.AMapUI.version?u("不允许多个版本 AMapUI 混用"):s.length?window.AMapUI.loadUI(s,function(){for(var p=0,y=s.length;p<y;p++){var j=s[p].split("/").slice(-1)[0];window.AMapUI[j]=arguments[p]}g()}):g():e.version&&e.version!==a.AMapUI.version?u("不允许多个版本 AMapUI 混用"):b.AMapUI.push(function(p){p?u(p):s.length?window.AMapUI.loadUI(s,function(){for(var y=0,j=s.length;y<j;y++){var R=s[y].split("/").slice(-1)[0];window.AMapUI[R]=arguments[y]}g()}):g()})})}function v(e){return new Promise(function(g,u){if(n.Loca===i.failed)u("前次请求 Loca 失败");else if(n.Loca===i.notload){n.Loca=i.loading,a.Loca.version=e.version||a.Loca.version;var s=a.Loca.version,c=a.AMap.version.startsWith("2"),_=s.startsWith("2");if(c&&!_||!c&&_)u("JSAPI 与 Loca 版本不对应！！");else{c=a.key,_=document.body||document.head;var w=document.createElement("script");w.type="text/javascript",w.src="https://webapi.amap.com/loca?v="+s+"&key="+c,w.onerror=function(p){n.Loca=i.failed,u("请求 AMapUI 失败")},w.onload=function(){for(n.Loca=i.loaded,g();b.Loca.length;)b.Loca.splice(0,1)[0]()},_.appendChild(w)}}else n.Loca===i.loaded?e.version&&e.version!==a.Loca.version?u("不允许多个版本 Loca 混用"):g():e.version&&e.version!==a.Loca.version?u("不允许多个版本 Loca 混用"):b.Loca.push(function(p){p?u(p):u()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var i;(function(e){e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed"})(i||(i={}));var a={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},n={AMap:i.notload,AMapUI:i.notload,Loca:i.notload},b={AMapUI:[],Loca:[]},o=[],I=function(e){typeof e=="function"&&(n.AMap===i.loaded?e(window.AMap):o.push(e))};return{load:function(e){return new Promise(function(g,u){if(n.AMap==i.failed)u("");else if(n.AMap==i.notload){var s=e.key,c=e.version,_=e.plugins;s?(window.AMap&&location.host!=="lbs.amap.com"&&u("禁止多种API加载方式混用"),a.key=s,a.AMap.version=c||a.AMap.version,a.AMap.plugins=_||a.AMap.plugins,n.AMap=i.loading,c=document.body||document.head,window.___onAPILoaded=function(p){if(delete window.___onAPILoaded,p)n.AMap=i.failed,u(p);else for(n.AMap=i.loaded,f(e).then(function(){g(window.AMap)}).catch(u);o.length;)o.splice(0,1)[0]()},_=document.createElement("script"),_.type="text/javascript",_.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+a.AMap.version+"&key="+s+"&plugin="+a.AMap.plugins.join(","),_.onerror=function(p){n.AMap=i.failed,u(p)},c.appendChild(_)):u("请填写key")}else if(n.AMap==i.loaded)if(e.key&&e.key!==a.key)u("多个不一致的 key");else if(e.version&&e.version!==a.AMap.version)u("不允许多个版本 JSAPI 混用");else{if(s=[],e.plugins)for(c=0;c<e.plugins.length;c+=1)a.AMap.plugins.indexOf(e.plugins[c])==-1&&s.push(e.plugins[c]);s.length?window.AMap.plugin(s,function(){f(e).then(function(){g(window.AMap)}).catch(u)}):f(e).then(function(){g(window.AMap)}).catch(u)}else if(e.key&&e.key!==a.key)u("多个不一致的 key");else if(e.version&&e.version!==a.AMap.version)u("不允许多个版本 JSAPI 混用");else{var w=[];if(e.plugins)for(c=0;c<e.plugins.length;c+=1)a.AMap.plugins.indexOf(e.plugins[c])==-1&&w.push(e.plugins[c]);I(function(){w.length?window.AMap.plugin(w,function(){f(e).then(function(){g(window.AMap)}).catch(u)}):f(e).then(function(){g(window.AMap)}).catch(u)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,a={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},n={AMap:i.notload,AMapUI:i.notload,Loca:i.notload},b={AMap:[],AMapUI:[],Loca:[]}}}})}(K)),K.exports}var We=Ve();const He=xe(We);var X,be;function ke(){if(be)return X;be=1;function d(l){var f=typeof l;return l!=null&&(f=="object"||f=="function")}return X=d,X}var Q,he;function Je(){if(he)return Q;he=1;var d=typeof J=="object"&&J&&J.Object===Object&&J;return Q=d,Q}var Y,_e;function qe(){if(_e)return Y;_e=1;var d=Je(),l=typeof self=="object"&&self&&self.Object===Object&&self,f=d||l||Function("return this")();return Y=f,Y}var ee,we;function Ke(){if(we)return ee;we=1;var d=qe(),l=function(){return d.Date.now()};return ee=l,ee}var te,Me;function Ze(){if(Me)return te;Me=1;var d=/\s/;function l(f){for(var m=f.length;m--&&d.test(f.charAt(m)););return m}return te=l,te}var ne,Ae;function Xe(){if(Ae)return ne;Ae=1;var d=Ze(),l=/^\s+/;function f(m){return m&&m.slice(0,d(m)+1).replace(l,"")}return ne=f,ne}var ae,Ie;function Oe(){if(Ie)return ae;Ie=1;var d=qe(),l=d.Symbol;return ae=l,ae}var oe,ye;function Qe(){if(ye)return oe;ye=1;var d=Oe(),l=Object.prototype,f=l.hasOwnProperty,m=l.toString,v=d?d.toStringTag:void 0;function i(a){var n=f.call(a,v),b=a[v];try{a[v]=void 0;var o=!0}catch{}var I=m.call(a);return o&&(n?a[v]=b:delete a[v]),I}return oe=i,oe}var re,Te;function Ye(){if(Te)return re;Te=1;var d=Object.prototype,l=d.toString;function f(m){return l.call(m)}return re=f,re}var ie,Se;function et(){if(Se)return ie;Se=1;var d=Oe(),l=Qe(),f=Ye(),m="[object Null]",v="[object Undefined]",i=d?d.toStringTag:void 0;function a(n){return n==null?n===void 0?v:m:i&&i in Object(n)?l(n):f(n)}return ie=a,ie}var se,Le;function tt(){if(Le)return se;Le=1;function d(l){return l!=null&&typeof l=="object"}return se=d,se}var ue,Ue;function nt(){if(Ue)return ue;Ue=1;var d=et(),l=tt(),f="[object Symbol]";function m(v){return typeof v=="symbol"||l(v)&&d(v)==f}return ue=m,ue}var le,Ce;function at(){if(Ce)return le;Ce=1;var d=Xe(),l=ke(),f=nt(),m=NaN,v=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,a=/^0o[0-7]+$/i,n=parseInt;function b(o){if(typeof o=="number")return o;if(f(o))return m;if(l(o)){var I=typeof o.valueOf=="function"?o.valueOf():o;o=l(I)?I+"":I}if(typeof o!="string")return o===0?o:+o;o=d(o);var e=i.test(o);return e||a.test(o)?n(o.slice(2),e?2:8):v.test(o)?m:+o}return le=b,le}var ce,je;function ot(){if(je)return ce;je=1;var d=ke(),l=Ke(),f=at(),m="Expected a function",v=Math.max,i=Math.min;function a(n,b,o){var I,e,g,u,s,c,_=0,w=!1,p=!1,y=!0;if(typeof n!="function")throw new TypeError(m);b=f(b)||0,d(o)&&(w=!!o.leading,p="maxWait"in o,g=p?v(f(o.maxWait)||0,b):g,y="trailing"in o?!!o.trailing:y);function j(t){var r=I,h=e;return I=e=void 0,_=t,u=n.apply(h,r),u}function R(t){return _=t,s=setTimeout(q,b),w?j(t):u}function Z(t){var r=t-c,h=t-_,A=b-r;return p?i(A,g-h):A}function P(t){var r=t-c,h=t-_;return c===void 0||r>=b||r<0||p&&h>=g}function q(){var t=l();if(P(t))return F(t);s=setTimeout(q,Z(t))}function F(t){return s=void 0,y&&I?j(t):(I=e=void 0,u)}function V(){s!==void 0&&clearTimeout(s),_=0,I=c=e=s=void 0}function D(){return s===void 0?u:F(l())}function G(){var t=l(),r=P(t);if(I=arguments,e=this,c=t,r){if(s===void 0)return R(c);if(p)return clearTimeout(s),s=setTimeout(q,b),j(c)}return s===void 0&&(s=setTimeout(q,b)),u}return G.cancel=V,G.flush=D,G}return ce=a,ce}var rt=ot();const it=xe(rt),st={class:"home-container"},ut={class:"split-layout"},lt={class:"left-panel"},ct={class:"info-card"},dt={class:"card-content"},ft={class:"vehicle-list"},pt={class:"list-header"},vt={class:"title"},mt={class:"count"},gt={class:"list-content"},bt={class:"vehicle-item"},ht={class:"vehicle-info"},_t={class:"truncate-text client-id"},wt={class:"truncate-text plate-no"},Mt={class:"create-time"},At={class:"right-panel"},It=Ne({__name:"MonitorView",setup(d){const l=C(""),f=C(""),m=C(null);let v=null,i=new Map,a=null,n=null;const b=C(!1);C(!0);const o=C([]),I=C(!1),e=C(null),g=C(""),u=pe(()=>o.value.filter(t=>t.clientStatus===1).length),s=pe(()=>{if(!g.value)return o.value;const t=g.value.toLowerCase();return o.value.filter(r=>r.clientId.toLowerCase().includes(t)||r.plateNo&&r.plateNo.toLowerCase().includes(t))}),c=()=>{},_=async()=>{try{const t=await Ee({});if(t.data&&t.data.jtt808){const{accessIp:r,cmdPort:h}=t.data.jtt808;l.value=r,f.value=h}}catch(t){console.error("Failed to fetch info data:",t),me.error("Failed to load system information")}},w=C(new Map),p=C(!1),y=it(t=>{if(!(!v||!n||p.value)){p.value=!0;try{t.forEach(r=>{var de;if(!r)return;const{latitude:h,longitude:A,clientStatus:U,alarmName:S,clientId:L}=r,T=h/1e6,O=A/1e6,x=w.value.get(L),$=((de=e.value)==null?void 0:de.clientId)===L;if(!x||x.latitude!==h||x.longitude!==A||x.clientStatus!==U||x.alarmName!==S||x.isSelected!==$)if(w.value.set(L,{...r,isSelected:$}),i.has(L)){const E=i.get(L);E.setPosition([O,T]);const W=document.createElement("div");W.className=`custom-marker ${P(U)} ${$?"selected":""}`,E.setContent(W);const H=S?`${r.plateNo||r.clientId}
${S}`:r.plateNo||r.clientId;E.setLabel({content:H,direction:"top",offset:new n.Pixel(0,-10)}),b.value&&$&&v.setCenter([O,T])}else{const E=document.createElement("div");E.className=`custom-marker ${P(U)} ${$?"selected":""}`;const W=S?`${r.plateNo||r.clientId}
${S}`:r.plateNo||r.clientId,H=new n.Marker({position:[O,T],content:E,label:{content:W,direction:"top",offset:new n.Pixel(0,-10)}});v.add(H),i.set(L,H)}})}finally{p.value=!1}}},100),j=async()=>{try{I.value=!0;const t=await fe({});if(t.data&&t.data.length>0&&t.data.some(h=>{const A=o.value.find(U=>U.clientId===h.clientId);return!A||A.latitude!==h.latitude||A.longitude!==h.longitude||A.clientStatus!==h.clientStatus||A.alarmName!==h.alarmName})){o.value=t.data,y(t.data);const h=t.data.reduce((S,L)=>new Date(L.createTime)>new Date(S.createTime)?L:S,t.data[0]),{latitude:A,longitude:U}=h;initialCenter=[U/1e6,A/1e6],e.value=h,b.value=!0}}catch(t){console.error("Failed to fetch client location:",t)}finally{I.value=!1}},R=t=>{var r;if(((r=e.value)==null?void 0:r.clientId)===t.clientId)e.value=null,b.value=!1,y(o.value);else if(e.value=t,b.value=!0,t){const{latitude:h,longitude:A}=t,U=h/1e6,S=A/1e6;v.setCenter([S,U]),y(o.value)}},Z=t=>{switch(t){case 0:return"#999999";case 1:return"#52c41a";case 2:return"#ff4d4f";default:return"#999999"}},P=t=>{switch(t){case 0:return"offline";case 1:return"normal";case 2:return"alarm";default:return"offline"}},q=async()=>{if(m.value)try{n=await He.load({key:"a5c8f98239681769eb5f134a8017cc43",securityJsCode:"9a47acddedb3e97db340c99156e27c15",version:"2.0",plugins:["AMap.ToolBar","AMap.Scale","AMap.HawkEye","AMap.MapType","AMap.Geolocation"]});const t=await fe({});let r=[116.397428,39.90923],h=15;if(t.data&&t.data.length>0){o.value=t.data;const A=t.data.reduce((L,T)=>new Date(T.createTime)>new Date(L.createTime)?T:L,t.data[0]),{latitude:U,longitude:S}=A;r=[S/1e6,U/1e6],e.value=A,b.value=!0}v=new n.Map(m.value,{zoom:h,center:r,viewMode:"3D"}),v.addControl(new n.ToolBar),v.addControl(new n.Scale),v.addControl(new n.HawkEye({isOpen:!0})),v.addControl(new n.MapType),v.addControl(new n.Geolocation),v.on("complete",()=>{v.setZoomAndCenter(h,r,!0),y(o.value),F()}),v.on("zoomend",()=>{})}catch(t){console.error("Failed to load AMap:",t),me.error("地图加载失败")}},F=()=>{a=window.setInterval(j,1e4)},V=C(0),D=()=>{const t=document.querySelector(".list-content");t&&(V.value=t.clientHeight)};Re(async()=>{await _(),await q(),D(),window.addEventListener("resize",D)}),Pe(()=>{a&&clearInterval(a),window.removeEventListener("resize",D)});const G=t=>t.clientId;return(t,r)=>{const h=z("a-descriptions-item"),A=z("a-descriptions"),U=z("a-input"),S=z("a-list-item"),L=z("a-list");return Be(),De("div",st,[M("div",ut,[M("div",lt,[M("div",ct,[r[1]||(r[1]=M("div",{class:"card-header"},[M("span",{class:"title"},"Register Info")],-1)),M("div",dt,[N(A,{column:1,size:"small"},{default:B(()=>[N(h,{label:"Access IP"},{default:B(()=>[M("span",null,k(l.value),1)]),_:1}),N(h,{label:"Command Port"},{default:B(()=>[M("span",null,k(f.value),1)]),_:1})]),_:1})])]),M("div",ft,[M("div",pt,[M("span",vt,[r[2]||(r[2]=ve("车辆列表 ")),M("span",mt,k(u.value)+"/"+k(o.value.length),1)]),N(U,{value:g.value,"onUpdate:value":r[0]||(r[0]=T=>g.value=T),placeholder:"输入车牌号或终端号",style:{width:"180px","margin-left":"8px"},size:"small",onChange:c},null,8,["value"])]),M("div",gt,[N(L,{"data-source":s.value,loading:I.value,size:"small",virtual:!0,"item-height":40,height:V.value,"row-key":G},{renderItem:B(({item:T})=>{var O;return[N(S,{onClick:x=>R(T),class:Ge({active:((O=e.value)==null?void 0:O.clientId)===T.clientId})},{default:B(()=>[M("div",bt,[M("span",{class:"status-dot",style:$e({backgroundColor:Z(T.clientStatus)})},null,4),M("span",ht,[M("span",_t,k(T.clientId),1),r[3]||(r[3]=ve(" - ")),M("span",wt,k(T.plateNo),1),M("span",Mt,k(T.createTime),1)])])]),_:2},1032,["onClick","class"])]}),_:1},8,["data-source","loading","height"])])])]),M("div",At,[M("div",{ref_key:"mapRef",ref:m,class:"map"},null,512)])])])}}}),Ut=ze(It,[["__scopeId","data-v-3dbb6420"]]);export{Ut as default};
