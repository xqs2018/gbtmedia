import{d as F,r as o,j as T,C as P,b as h,c,w as v,f as p,F as C,y as U,h as b,o as x}from"./index-BYlyECpH.js";import{F as z}from"./FlvPlayerModal-CXw7H9j7.js";import{p as M,b as R}from"./jtt808-PzOwMx6L.js";import"./request-xFzgdMuq.js";const A=F({__name:"ClientChannelView",setup(S){const _=[{title:"终端手机号",dataIndex:"clientId",key:"clientId",customRender:()=>i.value},{title:"通道序号",dataIndex:"channelNo",key:"channelNo"},{title:"操作",key:"action",fixed:"right",width:350}],m=o([]),s=o({current:1,pageSize:10,total:0}),u=o(!1),g=async(a,e)=>{try{u.value=!0;const l={pageNo:a-1,pageSize:e,clientId:i.value};let d=(await M(l)).data.content[0].maxVideoChannels,t=[];for(let n=1;n<d+1;n++)t.push({channelNo:n});m.value=t.map(n=>({...n,loading:!1,loading1:!1})),s.value.total=t.length,s.value.current=a}catch(l){console.error("获取数据失败:",l)}finally{u.value=!1}},k=a=>{const{current:e,pageSize:l}=a;g(e,l)},N=P(),i=o("");T(()=>{i.value=N.query.clientId,g(s.value.current,s.value.pageSize)});const r=o(!1),f=o("");let I;const w=async a=>{a.loading=!0;try{const e=await R({clientId:i.value,channelNo:a.channelNo});I=e.data,f.value=e.data.httpFlv,r.value=!0}catch(e){console.log(e)}finally{a.loading=!1}},V=async()=>{r.value=!1};return(a,e)=>{const l=p("router-link"),y=p("a-button"),d=p("a-table");return x(),h(C,null,[c(d,{columns:_,"data-source":m.value,pagination:s.value,onChange:k,loading:u.value,scroll:{x:"max-content"}},{bodyCell:v(({column:t,record:n})=>[t.key==="action"?(x(),h(C,{key:0},[c(l,{to:"/JTT808/ClientChannelRecordView?clientId="+i.value+"&channelNo="+n.channelNo,style:{"margin-right":"10px"}},{default:v(()=>e[2]||(e[2]=[b("录像")])),_:2},1032,["to"]),c(y,{onClick:B=>w(n),style:{"margin-right":"12px"},loading:n.loading},{default:v(()=>e[3]||(e[3]=[b("播放")])),_:2},1032,["onClick","loading"])],64)):U("",!0)]),_:1},8,["data-source","pagination","loading"]),c(z,{visible:r.value,hasAudio:!0,flvUrl:f.value,onCancel:e[0]||(e[0]=t=>V()),"onUpdate:visible":e[1]||(e[1]=t=>r.value=t)},null,8,["visible","flvUrl"])],64)}}});export{A as default};
