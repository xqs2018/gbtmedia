import{v as W,w as X,c as Y,x as Z,y as ee,z as ae,A as te}from"./gbt28181-C3wyvrue.js";import{d as le,r as u,j as ne,b as h,c as n,z as O,y as c,w as i,f,F as K,h as g,t as w,x as M,i as D,o as v,_ as se}from"./index-BYlyECpH.js";import"./request-xFzgdMuq.js";const oe=le({__name:"PlatformView",setup(ie){const $=[{title:"名称",dataIndex:"name",key:"name"},{title:"上级平台ID",dataIndex:"platformId",key:"platformId"},{title:"上级平台域",dataIndex:"sipDomain",key:"sipDomain"},{title:"信令地址",dataIndex:"sipAddress",key:"sipAddress"},{title:"状态",dataIndex:"status",key:"status"},{title:"使用",dataIndex:"used",key:"used"},{title:"心跳时间",dataIndex:"keepaliveTime",key:"keepaliveTime"},{title:"注册时间",dataIndex:"registTime",key:"registTime"},{title:"操作",key:"action",fixed:"right",width:400}],T=u([]),d=u({current:1,pageSize:10,total:0}),U=u(!1),I=async(a,e)=>{try{const t={pageNo:a-1,pageSize:e},p=await W(t);T.value=p.data.content.map(m=>({...m,loading:!1})),d.value.total=p.data.page.totalElements,d.value.current=a}catch(t){console.error("获取数据失败:",t)}finally{U.value=!1}},q=a=>{const{current:e,pageSize:t}=a;I(e,t)};ne(()=>{I(d.value.current,d.value.pageSize)});const b=u(!1),z=u(),o=u({}),A=()=>{o.value={},b.value=!0},F=a=>{o.value=JSON.parse(JSON.stringify(a)),b.value=!0},E=async()=>{var a;await((a=z.value)==null?void 0:a.validate());try{const e=JSON.parse(JSON.stringify(o.value)),t=await ae(e);D.success(t.message),await I(d.value.current,d.value.pageSize),b.value=!1}catch(e){console.error("操作失败:",e)}},B=()=>{b.value=!1},L=async a=>{a.loading=!0;try{const e=JSON.parse(JSON.stringify(a)),t=await X(e);D.success(t.message),await I(d.value.current,d.value.pageSize)}catch(e){console.log(e)}finally{a.loading=!1}},J=async(a,e)=>{a.loading=!0;try{const t=JSON.parse(JSON.stringify(a));t.enable=e;const p=await ee(t);D.success(p.message),await I(d.value.current,d.value.pageSize)}catch(t){console.log(t)}finally{a.loading=!1}},x=u(!1),V=u([]),y=u([]);u([]);const C=u([]),S=u([]);let N;const R=async a=>{N=a,a.loading=!0;try{let p=(await Y({})).data;p=p.map(s=>{let P=s.children.map(k=>({title:k.gbId+"("+k.customName+")",key:s.gbId+"_"+k.gbId}));return{title:s.gbId+"("+s.customName+")",key:s.gbId,children:P}}),V.value=p,y.value=[],C.value=[],C.value=[],(await Z({platformId:N.platformId})).data.forEach(s=>{y.value.push(s.deviceId+"_"+s.channelId),C.value.push(s.deviceId+"_"+s.channelId),S.value.push(s.deviceId+"_"+s.channelId)}),x.value=!0}catch(e){console.error("获取数据失败:",e)}finally{a.loading=!1}},j=async()=>{try{let a=y.value.filter(t=>t.indexOf("_")>0).map(t=>({deviceId:t.split("_")[0],channelId:t.split("_")[1]}));const e=await te({platformId:N.platformId,platformChannelList:a});D.success(e.message)}catch(a){console.error("获取数据失败:",a)}x.value=!1},G=()=>{x.value=!1},H=a=>{y.value=a};return(a,e)=>{const t=f("a-button"),p=f("a-table"),m=f("a-input"),s=f("a-form-item"),P=f("a-form"),k=f("a-modal"),Q=f("a-tree");return v(),h(K,null,[n(t,{class:"editable-add-btn",style:{"margin-bottom":"16px"},onClick:e[0]||(e[0]=l=>A())},{default:i(()=>e[10]||(e[10]=[g("新增")])),_:1}),n(p,{columns:$,"data-source":T.value,pagination:d.value,onChange:q,loading:U.value,scroll:{x:"max-content"}},{bodyCell:i(({column:l,record:r})=>[l.key==="sipAddress"?(v(),h(K,{key:0},[g(w(r.sipIp)+":"+w(r.sipPort),1)],64)):c("",!0),l.key==="status"?(v(),h("span",{key:1,style:M({color:r.online=="1"?"green":"red"})},w(r.online=="1"?"在线":"离线"),5)):c("",!0),l.key==="used"?(v(),h("span",{key:2,style:M({color:r.enable=="1"?"green":"red"})},w(r.enable=="1"?"启用":"禁用"),5)):c("",!0),l.key==="action"?(v(),h(K,{key:3},[n(t,{onClick:_=>F(r),style:{"margin-right":"10px"}},{default:i(()=>e[11]||(e[11]=[g("更新")])),_:2},1032,["onClick"]),n(t,{onClick:_=>R(r),style:{"margin-right":"10px"}},{default:i(()=>e[12]||(e[12]=[g("共享通道")])),_:2},1032,["onClick"]),n(t,{danger:"",onClick:_=>L(r),style:{"margin-right":"10px"}},{default:i(()=>e[13]||(e[13]=[g("删除")])),_:2},1032,["onClick"]),r.enable=="0"?(v(),O(t,{key:0,onClick:_=>J(r,"1"),style:{"margin-right":"12px"},loading:r.loading},{default:i(()=>e[14]||(e[14]=[g(" 启用 ")])),_:2},1032,["onClick","loading"])):c("",!0),r.enable=="1"?(v(),O(t,{key:1,danger:"",onClick:_=>J(r,"0"),style:{"margin-right":"10px"},loading:r.loading},{default:i(()=>e[15]||(e[15]=[g(" 禁用 ")])),_:2},1032,["onClick","loading"])):c("",!0)],64)):c("",!0)]),_:1},8,["data-source","pagination","loading"]),n(k,{visible:b.value,title:"上级平台",onOk:E,onCancel:B},{default:i(()=>[n(P,{model:o.value,ref_key:"formRef",ref:z},{default:i(()=>[n(s,{label:"名称",name:"name",rules:[{required:!0,message:"请输入名称!"}]},{default:i(()=>[n(m,{value:o.value.name,"onUpdate:value":e[1]||(e[1]=l=>o.value.name=l)},null,8,["value"])]),_:1}),n(s,{label:"上级平台ID",name:"platformId",rules:[{required:!0,message:"请输入上级平台ID!"}]},{default:i(()=>[n(m,{value:o.value.platformId,"onUpdate:value":e[2]||(e[2]=l=>o.value.platformId=l)},null,8,["value"])]),_:1}),n(s,{label:"上级平台域",name:"sipDomain",rules:[{required:!0,message:"请输入上级平台域!"}]},{default:i(()=>[n(m,{value:o.value.sipDomain,"onUpdate:value":e[3]||(e[3]=l=>o.value.sipDomain=l)},null,8,["value"])]),_:1}),n(s,{label:"信令IP",name:"sipIp",rules:[{required:!0,message:"请输入信令IP!"}]},{default:i(()=>[n(m,{value:o.value.sipIp,"onUpdate:value":e[4]||(e[4]=l=>o.value.sipIp=l)},null,8,["value"])]),_:1}),n(s,{label:"信令端口",name:"sipPort",rules:[{required:!0,message:"请输入信令端口!"}]},{default:i(()=>[n(m,{value:o.value.sipPort,"onUpdate:value":e[5]||(e[5]=l=>o.value.sipPort=l)},null,8,["value"])]),_:1}),n(s,{label:"密码",name:"password"},{default:i(()=>[n(m,{value:o.value.password,"onUpdate:value":e[6]||(e[6]=l=>o.value.password=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"]),x.value?(v(),O(k,{key:0,visible:x.value,title:"设备通道树",onOk:j,onCancel:G,width:600,bodyStyle:{height:"500px",overflow:"auto"}},{default:i(()=>[n(Q,{"tree-data":V.value,onCheck:H,checkable:!0,expandedKeys:C.value,"onUpdate:expandedKeys":e[7]||(e[7]=l=>C.value=l),selectedKeys:S.value,"onUpdate:selectedKeys":e[8]||(e[8]=l=>S.value=l),checkedKeys:y.value,"onUpdate:checkedKeys":e[9]||(e[9]=l=>y.value=l)},null,8,["tree-data","expandedKeys","selectedKeys","checkedKeys"])]),_:1},8,["visible"])):c("",!0)],64)}}}),pe=se(oe,[["__scopeId","data-v-73c86df7"]]);export{pe as default};
