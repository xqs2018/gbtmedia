import{e as Oe,p as Re,f as Fe,g as De,s as me,t as Se,h as Ue,j as Be}from"./gbt28181-C3wyvrue.js";import{c as U,I as Te,A as ie,B as Ee,d as Le,r as q,j as ze,C as Pe,b as we,w as P,f as $,F as ke,y as K,x as Ve,t as We,z as re,h as X,e as S,q as xe,g as ve,i as be,o as Y,_ as je}from"./index-BYlyECpH.js";import{F as qe}from"./FlvPlayerModal-CXw7H9j7.js";import"./request-xFzgdMuq.js";var Ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M682 455V311l-76 76v68c-.1 50.7-42 92.1-94 92a95.8 95.8 0 01-52-15l-54 55c29.1 22.4 65.9 36 106 36 93.8 0 170-75.1 170-168z"}},{tag:"path",attrs:{d:"M833 446h-60c-4.4 0-8 3.6-8 8 0 140.3-113.7 254-254 254-63 0-120.7-23-165-61l-54 54a334.01 334.01 0 00179 81v102H326c-13.9 0-24.9 14.3-25 32v36c.1 4.4 2.9 8 6 8h408c3.2 0 6-3.6 6-8v-36c0-17.7-11-32-25-32H547V782c165.3-17.9 294-157.9 294-328 0-4.4-3.6-8-8-8zm13.1-377.7l-43.5-41.9a8 8 0 00-11.2.1l-129 129C634.3 101.2 577 64 511 64c-93.9 0-170 75.3-170 168v224c0 6.7.4 13.3 1.2 19.8l-68 68A252.33 252.33 0 01258 454c-.2-4.4-3.8-8-8-8h-60c-4.4 0-8 3.6-8 8 0 53 12.5 103 34.6 147.4l-137 137a8.03 8.03 0 000 11.3l42.7 42.7c3.1 3.1 8.2 3.1 11.3 0L846.2 79.8l.1-.1c3.1-3.2 3-8.3-.2-11.4zM417 401V232c0-50.6 41.9-92 94-92 46 0 84.1 32.3 92.3 74.7L417 401z"}}]},name:"audio-muted",theme:"outlined"};function Ae(D){for(var g=1;g<arguments.length;g++){var O=arguments[g]!=null?Object(arguments[g]):{},T=Object.keys(O);typeof Object.getOwnPropertySymbols=="function"&&(T=T.concat(Object.getOwnPropertySymbols(O).filter(function(F){return Object.getOwnPropertyDescriptor(O,F).enumerable}))),T.forEach(function(F){_e(D,F,O[F])})}return D}function _e(D,g,O){return g in D?Object.defineProperty(D,g,{value:O,enumerable:!0,configurable:!0,writable:!0}):D[g]=O,D}var he=function(g,O){var T=Ae({},g,O.attrs);return U(Te,Ae({},T,{icon:Ne}),null)};he.displayName="AudioMutedOutlined";he.inheritAttrs=!1;var He={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M842 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 140.3-113.7 254-254 254S258 594.3 258 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 168.7 126.6 307.9 290 327.6V884H326.7c-13.7 0-24.7 14.3-24.7 32v36c0 4.4 2.8 8 6.2 8h407.6c3.4 0 6.2-3.6 6.2-8v-36c0-17.7-11-32-24.7-32H548V782.1c165.3-18 294-158 294-328.1zM512 624c93.9 0 170-75.2 170-168V232c0-92.8-76.1-168-170-168s-170 75.2-170 168v224c0 92.8 76.1 168 170 168zm-94-392c0-50.6 41.9-92 94-92s94 41.4 94 92v224c0 50.6-41.9 92-94 92s-94-41.4-94-92V232z"}}]},name:"audio",theme:"outlined"};function Me(D){for(var g=1;g<arguments.length;g++){var O=arguments[g]!=null?Object(arguments[g]):{},T=Object.keys(O);typeof Object.getOwnPropertySymbols=="function"&&(T=T.concat(Object.getOwnPropertySymbols(O).filter(function(F){return Object.getOwnPropertyDescriptor(O,F).enumerable}))),T.forEach(function(F){Ge(D,F,O[F])})}return D}function Ge(D,g,O){return g in D?Object.defineProperty(D,g,{value:O,enumerable:!0,configurable:!0,writable:!0}):D[g]=O,D}var pe=function(g,O){var T=Me({},g,O.attrs);return U(Te,Me({},T,{icon:He}),null)};pe.displayName="AudioOutlined";pe.inheritAttrs=!1;var ye={exports:{}},Ce;function $e(){return Ce||(Ce=1,function(D){function g(o){if(!o)throw"MediaStream is mandatory.";this.start=function(a){var i;typeof MediaRecorder<"u"?i=le:(H||oe||ee)&&(this.mimeType.indexOf("video")!==-1?i=ne:this.mimeType.indexOf("audio")!==-1&&(i=ae)),this.mimeType==="image/gif"&&(i=ue),(this.mimeType==="audio/wav"||this.mimeType==="audio/pcm")&&(i=ae),this.recorderType&&(i=this.recorderType),e=new i(o),e.blobs=[];var n=this;e.ondataavailable=function(d){e.blobs.push(d),n.ondataavailable(d)},e.onstop=this.onstop,e.onStartedDrawingNonBlankFrames=this.onStartedDrawingNonBlankFrames,e=se(e,this),e.start(a)},this.onStartedDrawingNonBlankFrames=function(){},this.clearOldRecordedFrames=function(){e&&e.clearOldRecordedFrames()},this.stop=function(){e&&e.stop()},this.ondataavailable=function(a){console.log("ondataavailable..",a)},this.onstop=function(a){console.warn("stopped..",a)},this.save=function(a,i){if(!a){if(!e)return;ConcatenateBlobs(e.blobs,e.blobs[0].type,function(n){N(n)});return}N(a,i)},this.pause=function(){e&&(e.pause(),console.log("Paused recording.",this.mimeType||e.mimeType))},this.resume=function(){e&&(e.resume(),console.log("Resumed recording.",this.mimeType||e.mimeType))},this.recorderType=null,this.mimeType="video/webm",this.disableLogs=!1;var e}function O(o){if(!o)throw"MediaStream is mandatory.";var e=this,a=de();this.stream=o,this.start=function(v){i=new g(o),n=new g(o),i.mimeType="audio/ogg",n.mimeType="video/webm";for(var p in this)typeof this[p]!="function"&&(i[p]=n[p]=this[p]);i.ondataavailable=function(y){d[r]||(d[r]={}),d[r].audio=y,d[r].video&&!d[r].onDataAvailableEventFired&&(d[r].onDataAvailableEventFired=!0,m(d[r]))},n.ondataavailable=function(y){if(a)return e.ondataavailable({video:y,audio:y});d[r]||(d[r]={}),d[r].video=y,d[r].audio&&!d[r].onDataAvailableEventFired&&(d[r].onDataAvailableEventFired=!0,m(d[r]))};function m(y){r++,e.ondataavailable(y)}n.onstop=i.onstop=function(y){e.onstop(y)},a||(n.onStartedDrawingNonBlankFrames=function(){n.clearOldRecordedFrames(),i.start(v)}),n.start(v)},this.stop=function(){i&&i.stop(),n&&n.stop()},this.ondataavailable=function(v){console.log("ondataavailable..",v)},this.onstop=function(v){console.warn("stopped..",v)},this.pause=function(){i&&i.pause(),n&&n.pause()},this.resume=function(){i&&i.resume(),n&&n.resume()};var i,n,d={},r=0}typeof g<"u"&&(g.MultiStreamRecorder=O);var T="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(o){typeof window<"u"||(typeof window>"u"&&typeof ie<"u"&&(ie.navigator={userAgent:T,getUserMedia:function(){}},o.window=ie),typeof document>"u"&&(o.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){return{}}),typeof location>"u"&&(o.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(o.screen={width:0,height:0}))})(typeof ie<"u"?ie:window);var F=window.AudioContext;typeof F>"u"&&(typeof webkitAudioContext<"u"&&(F=webkitAudioContext),typeof mozAudioContext<"u"&&(F=mozAudioContext)),typeof window>"u"&&(window={});var F=window.AudioContext;typeof F>"u"&&(typeof webkitAudioContext<"u"&&(F=webkitAudioContext),typeof mozAudioContext<"u"&&(F=mozAudioContext));var E=window.URL;typeof E>"u"&&typeof webkitURL<"u"&&(E=webkitURL),typeof navigator<"u"?(typeof navigator.webkitGetUserMedia<"u"&&(navigator.getUserMedia=navigator.webkitGetUserMedia),typeof navigator.mozGetUserMedia<"u"&&(navigator.getUserMedia=navigator.mozGetUserMedia)):navigator={getUserMedia:function(){},userAgent:T};var ee=navigator.userAgent.indexOf("Edge")!==-1&&(!!navigator.msSaveBlob||!!navigator.msSaveOrOpenBlob),oe=!1;typeof opera<"u"&&navigator.userAgent&&navigator.userAgent.indexOf("OPR/")!==-1&&(oe=!0);var H=!ee&&!ee&&!!navigator.webkitGetUserMedia,L=window.MediaStream;typeof L>"u"&&typeof webkitMediaStream<"u"&&(L=webkitMediaStream),typeof L<"u"&&("getVideoTracks"in L.prototype||(L.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var o=[];return this.getTracks.forEach(function(e){e.kind.toString().indexOf("video")!==-1&&o.push(e)}),o},L.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var o=[];return this.getTracks.forEach(function(e){e.kind.toString().indexOf("audio")!==-1&&o.push(e)}),o}),"stop"in L.prototype||(L.prototype.stop=function(){this.getAudioTracks().forEach(function(o){o.stop&&o.stop()}),this.getVideoTracks().forEach(function(o){o.stop&&o.stop()})})),typeof location<"u"&&location.href.indexOf("file:")===0&&console.error("Please load this HTML file on HTTP or HTTPS.");function se(o,e){for(var a in e)typeof e[a]!="function"&&(o[a]=e[a]);return o}function N(o,e){if(!o)throw"Blob object is required.";if(!o.type)try{o.type="video/webm"}catch{}var a=(o.type||"video/webm").split("/")[1];if(e&&e.indexOf(".")!==-1){var i=e.split(".");e=i[0],a=i[1]}var n=(e||Math.round(Math.random()*9999999999)+888888888)+"."+a;if(typeof navigator.msSaveOrOpenBlob<"u")return navigator.msSaveOrOpenBlob(o,n);if(typeof navigator.msSaveBlob<"u")return navigator.msSaveBlob(o,n);var d=document.createElement("a");d.href=E.createObjectURL(o),d.target="_blank",d.download=n,navigator.mozGetUserMedia&&(d.onclick=function(){(document.body||document.documentElement).removeChild(d)},(document.body||document.documentElement).appendChild(d));var r=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});d.dispatchEvent(r),navigator.mozGetUserMedia||E.revokeObjectURL(d.href)}function te(o){var e=1e3,a=["Bytes","KB","MB","GB","TB"];if(o===0)return"0 Bytes";var i=parseInt(Math.floor(Math.log(o)/Math.log(e)),10);return(o/Math.pow(e,i)).toPrecision(3)+" "+a[i]}var W={AudioContext:F};function de(){var o=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,e=!!window.chrome&&!o,a=typeof window.InstallTrigger<"u";if(a)return!0;if(!e)return!1;var i=navigator.userAgent,n=""+parseFloat(navigator.appVersion),d=parseInt(navigator.appVersion,10),r,v;return e&&(r=i.indexOf("Chrome"),n=i.substring(r+7)),(v=n.indexOf(";"))!==-1&&(n=n.substring(0,v)),(v=n.indexOf(" "))!==-1&&(n=n.substring(0,v)),d=parseInt(""+n,10),isNaN(d)&&(n=""+parseFloat(navigator.appVersion),d=parseInt(navigator.appVersion,10)),d>=49}var W={AudioContext:window.AudioContext||window.webkitAudioContext};function le(o){var e=this;this.start=function(n,d){if(e.mimeType||(e.mimeType="video/webm"),e.mimeType.indexOf("audio")!==-1&&o.getVideoTracks().length&&o.getAudioTracks().length){var r;navigator.mozGetUserMedia?(r=new L,r.addTrack(o.getAudioTracks()[0])):r=new L(o.getAudioTracks()),o=r}e.mimeType.indexOf("audio")!==-1&&(e.mimeType=H?"audio/webm":"audio/ogg"),e.dontFireOnDataAvailableEvent=!1;var v={mimeType:e.mimeType};!e.disableLogs&&!d&&console.log("Passing following params over MediaRecorder API.",v),a&&(a=null),H&&!de()&&(v="video/vp8");try{a=new MediaRecorder(o,v)}catch{a=new MediaRecorder(o)}"canRecordMimeType"in a&&a.canRecordMimeType(e.mimeType)===!1&&(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",e.mimeType)),a.ignoreMutedMedia=e.ignoreMutedMedia||!1;var p=!1;a.ondataavailable=function(m){if(!e.dontFireOnDataAvailableEvent&&!(!m.data||!m.data.size||m.data.size<26800||p)){p=!0;var y=e.getNativeBlob?m.data:new Blob([m.data],{type:e.mimeType||"video/webm"});e.ondataavailable(y),e.dontFireOnDataAvailableEvent=!0,a&&(a.stop(),a=null),e.start(n,"__disableLogs")}},a.onerror=function(m){e.disableLogs||(m.name==="InvalidState"?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed."):m.name==="OutOfMemory"?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute."):m.name==="IllegalStreamModification"?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute."):m.name==="OtherRecordingError"?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute."):m.name==="GenericError"?console.error("The UA cannot provide the codec or recording option that has been requested.",m):console.error("MediaRecorder Error",m)),a&&a.state!=="inactive"&&a.state!=="stopped"&&a.stop()};try{a.start(36e5)}catch{a=null}setTimeout(function(){a&&a.state==="recording"&&a.requestData()},n)},this.stop=function(n){a&&a.state==="recording"&&(a.requestData(),setTimeout(function(){e.dontFireOnDataAvailableEvent=!0,a&&a.state==="recording"&&a.stop(),a=null},2e3))},this.pause=function(){a&&a.state==="recording"&&a.pause()},this.ondataavailable=function(n){console.log("recorded-blob",n)},this.resume=function(){if(this.dontFireOnDataAvailableEvent){this.dontFireOnDataAvailableEvent=!1;var n=e.disableLogs;e.disableLogs=!0,this.record(),e.disableLogs=n;return}a&&a.state==="paused"&&a.resume()},this.clearRecordedData=function(){a&&(this.pause(),this.dontFireOnDataAvailableEvent=!0,this.stop())};var a;function i(){if("active"in o){if(!o.active)return!1}else if("ended"in o&&o.ended)return!1;return!0}(function n(){if(a){if(i()===!1){e.stop();return}setTimeout(n,1e3)}})()}typeof g<"u"&&(g.MediaRecorderWrapper=le);function ae(o){this.start=function(i){i=i||1e3,e=new Z(o,this),e.record(),a=setInterval(function(){e.requestData()},i)},this.stop=function(){e&&(e.stop(),clearTimeout(a))},this.pause=function(){e&&e.pause()},this.resume=function(){e&&e.resume()},this.ondataavailable=function(){};var e,a}typeof g<"u"&&(g.StereoAudioRecorder=ae);function Z(o,e){var a=44100;W.AudioContextConstructor||(W.AudioContextConstructor=new W.AudioContext),a=W.AudioContextConstructor.sampleRate;var i=[],n=[],d,r=!1,v=0,s,f,p=e.sampleRate||a,m=e.mimeType||"audio/wav",y=m.indexOf("audio/pcm")>-1,R,C=e.audioChannels||2;this.record=function(){r=!0,i.length=n.length=0,v=0},this.requestData=function(){if(!b){if(v===0){l=!1;return}l=!0;var k=i.slice(0),A=n.slice(0),c=v;i.length=n.length=[],v=0,l=!1;var x=u(k,c),M=x;if(C===2){var B=u(A,c);M=V(x,B)}if(y){var j=new Blob([h(M)],{type:"audio/pcm"});console.debug("audio recorded blob size:",te(j.size)),e.ondataavailable(j);return}var z=new ArrayBuffer(44+M.length*2),I=new DataView(z);t(I,0,"RIFF"),I.setUint32(4,44+M.length*2-8,!0),t(I,8,"WAVE"),t(I,12,"fmt "),I.setUint32(16,16,!0),I.setUint16(20,1,!0),I.setUint16(22,C,!0),I.setUint32(24,p,!0),I.setUint32(28,p*C*2,!0),I.setUint16(32,C*2,!0),I.setUint16(34,16,!0),t(I,36,"data"),I.setUint32(40,M.length*2,!0);for(var J=M.length,Q=44,fe=1,G=0;G<J;G++)I.setInt16(Q,M[G]*(32767*fe),!0),Q+=2;var j=new Blob([I],{type:"audio/wav"});console.debug("audio recorded blob size:",te(j.size)),e.ondataavailable(j)}},this.stop=function(){r=!1,this.requestData(),f.disconnect()};function V(k,A){for(var c=k.length+A.length,x=new Float32Array(c),M=0,B=0;B<c;)x[B++]=k[M],x[B++]=A[M],M++;return x}function u(k,A){for(var c=new Float32Array(A),x=0,M=k.length,B=0;B<M;B++){var z=k[B];c.set(z,x),x+=z.length}return c}function t(k,A,c){for(var x=c.length,M=0;M<x;M++)k.setUint8(A+M,c.charCodeAt(M))}function h(k){for(var A=k.length,c=new Int16Array(A);A--;)c[A]=k[A]*65535;return c.buffer}var R=W.AudioContextConstructor;W.VolumeGainNode=R.createGain();var s=W.VolumeGainNode;W.AudioInput=R.createMediaStreamSource(o);var f=W.AudioInput;f.connect(s);var w=e.bufferSize||2048;if(e.bufferSize===0&&(w=0),R.createJavaScriptNode)d=R.createJavaScriptNode(w,C,C);else if(R.createScriptProcessor)d=R.createScriptProcessor(w,C,C);else throw"WebAudio API has no support on this browser.";w=d.bufferSize,console.debug("using audio buffer-size:",w);var l=!1;window.scriptprocessornode=d,C===1&&console.debug("All right-channels are skipped.");var b=!1;this.pause=function(){b=!0},this.resume=function(){b=!1},d.onaudioprocess=function(k){if(!(!r||l||b)){var A=k.inputBuffer.getChannelData(0);if(i.push(new Float32Array(A)),C===2){var c=k.inputBuffer.getChannelData(1);n.push(new Float32Array(c))}v+=w}},s.connect(d),d.connect(R.destination)}typeof g<"u"&&(g.StereoAudioRecorderHelper=Z);function ne(o){this.start=function(i){i=i||1e3,e=new _(o,this);for(var n in this)typeof this[n]!="function"&&(e[n]=this[n]);e.record(),a=setInterval(function(){e.requestData()},i)},this.stop=function(){e&&(e.stop(),clearTimeout(a))},this.clearOldRecordedFrames=function(){e&&e.clearOldRecordedFrames()},this.pause=function(){e&&e.pause()},this.resume=function(){e&&e.resume()},this.ondataavailable=function(){};var e,a}typeof g<"u"&&(g.WhammyRecorder=ne);function _(o,e){this.record=function(h){this.width||(this.width=320),this.height||(this.height=240),this.video&&this.video instanceof HTMLVideoElement&&(this.width||(this.width=p.videoWidth||p.clientWidth||320),this.height||(this.height=p.videoHeight||p.clientHeight||240)),this.video||(this.video={width:this.width,height:this.height}),(!this.canvas||!this.canvas.width||!this.canvas.height)&&(this.canvas={width:this.width,height:this.height}),r.width=this.canvas.width,r.height=this.canvas.height,this.video&&this.video instanceof HTMLVideoElement?(this.isHTMLObject=!0,p=this.video.cloneNode()):(p=document.createElement("video"),p.src=E.createObjectURL(o),p.width=this.video.width,p.height=this.video.height),p.muted=!0,p.play(),m=new Date().getTime(),y=new ce.Video(e.speed,e.quality),console.log("canvas resolutions",r.width,"*",r.height),console.log("video width/height",p.width||r.width,"*",p.height||r.height),n()},this.clearOldRecordedFrames=function(){y.frames=[]};var a=!1;this.requestData=function(){if(!t){if(!y.frames.length){a=!1;return}a=!0;var h=y.frames.slice(0);y.frames=u(h),y.compile(function(R){e.ondataavailable(R),console.debug("video recorded blob size:",te(R.size))}),y.frames=[],a=!1}};var i=!1;function n(){if(t){m=new Date().getTime(),setTimeout(n,500);return}if(!d){if(a)return setTimeout(n,100);var h=new Date().getTime()-m;if(!h)return n();m=new Date().getTime(),!C.isHTMLObject&&p.paused&&p.play(),v.drawImage(p,0,0,r.width,r.height),d||y.frames.push({duration:h,image:r.toDataURL("image/webp")}),!i&&!V(y.frames[y.frames.length-1])&&(i=!0,e.onStartedDrawingNonBlankFrames()),setTimeout(n,10)}}var d=!1;this.stop=function(){d=!0,this.requestData()};var r=document.createElement("canvas"),v=r.getContext("2d"),p,m,y,C=this;function V(h,R,s){var f=document.createElement("canvas");f.width=r.width,f.height=r.height;var w=f.getContext("2d"),l={r:0,g:0,b:0},b=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),k=0,A=0,c,x,M,B=new Image;B.src=h.image,w.drawImage(B,0,0,r.width,r.height);var z=w.getImageData(0,0,r.width,r.height);c=0,x=z.data.length,M=z.data.length/4;for(var I=0;I<x;I+=4){var J={r:z.data[I],g:z.data[I+1],b:z.data[I+2]},Q=Math.sqrt(Math.pow(J.r-l.r,2)+Math.pow(J.g-l.g,2)+Math.pow(J.b-l.b,2));Q<=b*k&&c++}return!(M-c<=M*A)}function u(h,R,s,f){var w=document.createElement("canvas");w.width=r.width,w.height=r.height;for(var l=w.getContext("2d"),b=[],k=h.length,A={r:0,g:0,b:0},c=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),x=0,M=0,B=!1,z=0;z<k;z++){var I,J,Q;if(!B){var fe=new Image;fe.src=h[z].image,l.drawImage(fe,0,0,r.width,r.height);var G=l.getImageData(0,0,r.width,r.height);I=0,J=G.data.length,Q=G.data.length/4;for(var j=0;j<J;j+=4){var ge={r:G.data[j],g:G.data[j+1],b:G.data[j+2]},Ie=Math.sqrt(Math.pow(ge.r-A.r,2)+Math.pow(ge.g-A.g,2)+Math.pow(ge.b-A.b,2));Ie<=c*x&&I++}}!B&&Q-I<=Q*M||(B=!0,b.push(h[z]))}return b=b.concat(h.slice(k)),b.length<=0&&b.push(h[h.length-1]),b}var t=!1;this.pause=function(){t=!0},this.resume=function(){t=!1}}typeof g<"u"&&(g.WhammyRecorderHelper=_);function ue(o){if(typeof GIFEncoder>"u")throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";this.start=function(C){C=C||1e3;var V=this.videoWidth||320,u=this.videoHeight||240;n.width=r.width=V,n.height=r.height=u,m=new GIFEncoder,m.setRepeat(0),m.setDelay(this.frameRate||this.speed||200),m.setQuality(this.quality||1),m.start();function t(h){if(a){setTimeout(t,500,h);return}v=requestAnimationFrame(t),typeof p===void 0&&(p=h),!(h-p<90)&&(r.paused&&r.play(),d.drawImage(r,0,0,V,u),m.addFrame(d),p=h)}v=requestAnimationFrame(t),y=setTimeout(e,C)};function e(){var C=new Blob([new Uint8Array(m.stream().bin)],{type:"image/gif"});i.ondataavailable(C),m.stream().bin=[]}this.stop=function(){v&&(cancelAnimationFrame(v),clearTimeout(y),e())};var a=!1;this.pause=function(){a=!0},this.resume=function(){a=!1},this.ondataavailable=function(){},this.onstop=function(){};var i=this,n=document.createElement("canvas"),d=n.getContext("2d"),r=document.createElement("video");r.muted=!0,r.autoplay=!0,r.src=E.createObjectURL(o),r.play();var v=null,p,m,y}typeof g<"u"&&(g.GifRecorder=ue);var ce=function(){function o(i,n){this.frames=[],i||(i=1),this.duration=1e3/i,this.quality=n||.8}o.prototype.add=function(i,n){if("canvas"in i&&(i=i.canvas),"toDataURL"in i&&(i=i.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/ig.test(i))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:i,duration:n||this.duration})};function e(i){var n=E.createObjectURL(new Blob([i.toString(),"this.onmessage =  function (e) {"+i.name+"(e.data);}"],{type:"application/javascript"})),d=new Worker(n);return E.revokeObjectURL(n),d}function a(i){function n(s){var f=r(s);if(!f)return[];for(var w=3e4,l=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:h(f.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:f.width,id:176},{data:f.height,id:186}]}]}]}]}],b=0,k=0;b<s.length;){var A=[],c=0;do A.push(s[b]),c+=s[b].duration,b++;while(b<s.length&&c<w);var x=0,M={id:524531317,data:d(k,x,A)};l[1].data.push(M),k+=c}return y(l)}function d(s,f,w){return[{data:s,id:231}].concat(w.map(function(l){var b=C({frame:l.data.slice(4),trackNum:1,timecode:Math.round(f)});return f+=l.duration,{data:b,id:163}}))}function r(s){if(!s[0]){postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});return}for(var f=s[0].width,w=s[0].height,l=s[0].duration,b=1;b<s.length;b++)l+=s[b].duration;return{duration:l,width:f,height:w}}function v(s){for(var f=[];s>0;)f.push(s&255),s=s>>8;return new Uint8Array(f.reverse())}function p(s){return new Uint8Array(s.split("").map(function(f){return f.charCodeAt(0)}))}function m(s){var f=[],w=s.length%8?new Array(9-s.length%8).join("0"):"";s=w+s;for(var l=0;l<s.length;l+=8)f.push(parseInt(s.substr(l,8),2));return new Uint8Array(f)}function y(s){for(var f=[],w=0;w<s.length;w++){var l=s[w].data;typeof l=="object"&&(l=y(l)),typeof l=="number"&&(l=m(l.toString(2))),typeof l=="string"&&(l=p(l));var b=l.size||l.byteLength||l.length,k=Math.ceil(Math.ceil(Math.log(b)/Math.log(2))/8),A=b.toString(2),c=new Array(k*7+7+1-A.length).join("0")+A,x=new Array(k).join("0")+"1"+c;f.push(v(s[w].id)),f.push(m(x)),f.push(l)}return new Blob(f,{type:"video/webm"})}function C(s){var f=0;f|=128;var w=[s.trackNum|128,s.timecode>>8,s.timecode&255,f].map(function(l){return String.fromCharCode(l)}).join("")+s.frame;return w}function V(s){for(var f=s.RIFF[0].WEBP[0],w=f.indexOf("*"),l=0,b=[];l<4;l++)b[l]=f.charCodeAt(w+3+l);var k,A,c;return c=b[1]<<8|b[0],k=c&16383,c=b[3]<<8|b[2],A=c&16383,{width:k,height:A,data:f,riff:s}}function u(s,f){return parseInt(s.substr(f+4,4).split("").map(function(w){var l=w.charCodeAt(0).toString(2);return new Array(8-l.length+1).join("0")+l}).join(""),2)}function t(s){for(var f=0,w={};f<s.length;){var l=s.substr(f,4),b=u(s,f),k=s.substr(f+4+4,b);f+=8+b,w[l]=w[l]||[],l==="RIFF"||l==="LIST"?w[l].push(t(k)):w[l].push(k)}return w}function h(s){return[].slice.call(new Uint8Array(new Float64Array([s]).buffer),0).map(function(f){return String.fromCharCode(f)}).reverse().join("")}var R=new n(i.map(function(s){var f=V(t(atob(s.image.slice(23))));return f.duration=s.duration,f}));postMessage(R)}return o.prototype.compile=function(i){var n=e(a);n.onmessage=function(d){if(d.data.error){console.error(d.data.error);return}i(d.data)},n.postMessage(this.frames)},{Video:o}}();typeof g<"u"&&(g.Whammy=ce),function(){window.ConcatenateBlobs=function(o,e,a){var i=[],n=0;function d(){if(!o[n])return r();var v=new FileReader;v.onload=function(p){i.push(p.target.result),n++,d()},v.readAsArrayBuffer(o[n])}d();function r(){var v=0;i.forEach(function(C){v+=C.byteLength});var p=new Uint16Array(v),m=0;i.forEach(function(C){var V=C.byteLength;V%2!=0&&(C=C.slice(0,V-1)),p.set(new Uint16Array(C),m),m+=V});var y=new Blob([p.buffer],{type:e});a(y)}}}(),D.exports=g}(ye)),ye.exports}var Je=$e();const Qe=Ee(Je),Xe={class:"outer-container"},Ye={class:"square-container"},Ze={class:"square-container square-container-two"},Ke={class:"audio-container",style:{"pointer-events":"none"}},et={class:"audio-item"},tt={class:"audio-item"},at=Le({__name:"DeviceChannelView",setup(D){const g=[{title:"设备ID",dataIndex:"deviceId",key:"deviceId",customRender:()=>H.value},{title:"通道ID",dataIndex:"channelId",key:"channelId"},{title:"名称",dataIndex:"name",customRender:({record:u})=>u.customName||u.name},{title:"制造厂商",dataIndex:"manufacturer",key:"manufacturer"},{title:"型号",dataIndex:"model",key:"model"},{title:"状态",key:"online"},{title:"更新时间",dataIndex:"updateTime",key:"updateTime"},{title:"操作",key:"action",fixed:"right",width:400}],O=q([]),T=q({current:1,pageSize:10,total:0}),F=q(!1),E=async(u,t)=>{try{F.value=!0;const h={pageNo:u-1,pageSize:t,deviceId:H.value},R=await Oe(h);O.value=R.data.content.map(s=>({...s,loading:!1,loading1:!1,loading2:!1})),T.value.total=R.data.page.totalElements,T.value.current=u}catch(h){console.error("获取数据失败:",h)}finally{F.value=!1}},ee=u=>{const{current:t,pageSize:h}=u;E(t,h)},oe=Pe(),H=q("");ze(()=>{H.value=oe.query.deviceId,E(T.value.current,T.value.pageSize)});const L=q(!1),se=q("");let N,te;const de=async u=>{N=u,u.loading=!0;try{const t=await Re({deviceId:u.deviceId,channelId:u.channelId});te=t.data,se.value=t.data.httpFlv,L.value=!0,await E(T.value.current,T.value.pageSize)}catch(t){console.log(t)}finally{u.loading=!1}},W=async u=>{u.loading2=!0;try{await me({callId:u.playCallId}),await E(T.value.current,T.value.pageSize)}catch(t){console.log(t)}finally{u.loading2=!1}},le=async()=>{L.value=!1,a.value="",y(),i&&await me({callId:i})},ae=async u=>{u.loading1=!0;try{const t=await Fe({deviceId:u.deviceId,channelId:u.channelId});be.success(t.message)}catch(t){console.log(t)}finally{u.loading1=!1}await E(T.value.current,T.value.pageSize)},Z=q(!1),ne=q(),_=q({}),ue=u=>{_.value={...u,cloudRecord:String(u.cloudRecord)},Z.value=!0},ce=async()=>{var u;await((u=ne.value)==null?void 0:u.validate());try{const t=JSON.parse(JSON.stringify(_.value)),h=await Be(t);be.success(h.message),await E(T.value.current,T.value.pageSize),Z.value=!1}catch(t){console.error("操作失败:",t)}},o=()=>{Z.value=!1},e=async u=>{try{u.deviceId=N.deviceId,u.channelId=N.channelId;const t=await De(u)}catch(t){console.log(t)}finally{}},a=q("");let i;const n=q(""),d=async u=>{try{a.value==u?(a.value="",y()):a.value=u,n.value="audioLoading",i&&await me({callId:i});let t;if(a.value=="talk"){const h=await Se({deviceId:N.deviceId,channelId:N.channelId});t=h.data.httpWs,i=h.data.callId}if(a.value=="broadcast"){const h=await Ue({deviceId:N.deviceId,channelId:N.channelId});t=h.data.httpWs,i=h.data.callId}if(!t){a.value="",n.value="";return}n.value="audioLoadingOk",be.success(u+" "+t),await m(t)}catch(t){a.value="",n.value="",console.log(t)}finally{}};let r,v,p;const m=async u=>{try{v=new WebSocket(u),v.onopen=()=>{console.log("WebSocket 连接已建立")},v.onmessage=async t=>{const h=await C(t.data);V(h)},v.onerror=t=>{console.error("WebSocket 发生错误:",t)},v.onclose=()=>{console.log("WebSocket 连接已关闭")},p=await navigator.mediaDevices.getUserMedia({audio:!0}),r=new Qe(p),r.mimeType="audio/pcm",r.audioChannels=1,r.sampleRate=8e3,r.ondataavailable=async t=>{v&&v.readyState===WebSocket.OPEN&&v.send(await t.arrayBuffer())},r.start(30)}catch(t){console.error("获取麦克风权限失败:",t)}},y=()=>{r&&r.state==="recording"&&r.stop(),v&&v.close(),p&&p.getTracks().forEach(u=>u.stop())},C=async u=>{const t=await u.arrayBuffer();return new Int16Array(t)},V=u=>{const t=new(window.AudioContext||window.webkitAudioContext),h=t.createBuffer(1,u.length,t.sampleRate);h.getChannelData(0).set(u);const s=t.createBufferSource();s.buffer=h,s.connect(t.destination),s.start()};return(u,t)=>{const h=$("router-link"),R=$("a-button"),s=$("a-table"),f=$("a-input"),w=$("a-form-item"),l=$("a-select-option"),b=$("a-select"),k=$("a-form"),A=$("a-modal");return Y(),we(ke,null,[U(s,{columns:g,"data-source":O.value,pagination:T.value,onChange:ee,loading:F.value,scroll:{x:"max-content"}},{bodyCell:P(({column:c,record:x})=>[c.key==="online"?(Y(),we("span",{key:0,style:Ve({color:x.online=="1"?"green":"red"})},We(x.online=="1"?"在线":"离线"),5)):K("",!0),c.key==="action"?(Y(),we(ke,{key:1},[U(h,{to:"/GBT28181/DeviceChannelRecordView?deviceId="+H.value+"&channelId="+x.channelId,style:{"margin-right":"10px"}},{default:P(()=>t[15]||(t[15]=[X("录像")])),_:2},1032,["to"]),U(h,{to:"/GBT28181/DeviceChannelRecordFileView?deviceId="+H.value+"&channelId="+x.channelId,style:{"margin-right":"10px"}},{default:P(()=>t[16]||(t[16]=[X("文件")])),_:2},1032,["to"]),U(R,{onClick:M=>de(x),style:{"margin-right":"12px"},loading:x.loading},{default:P(()=>t[17]||(t[17]=[X("播放")])),_:2},1032,["onClick","loading"]),x.playCallId?(Y(),re(R,{key:0,danger:"",onClick:M=>W(x),style:{"margin-right":"12px"},loading:x.loading2},{default:P(()=>t[18]||(t[18]=[X("停止")])),_:2},1032,["onClick","loading"])):K("",!0),U(R,{onClick:M=>ue(x),style:{"margin-right":"10px"}},{default:P(()=>t[19]||(t[19]=[X("更新")])),_:2},1032,["onClick"]),U(R,{danger:"",onClick:M=>ae(x),style:{"margin-right":"10px"},loading:x.loading1},{default:P(()=>t[20]||(t[20]=[X("删除")])),_:2},1032,["onClick","loading"])],64)):K("",!0)]),_:1},8,["data-source","pagination","loading"]),U(A,{visible:Z.value,title:"通道信息",onOk:ce,onCancel:o},{default:P(()=>[U(k,{form:ne.value,model:_.value},{default:P(()=>[U(w,{label:"自定义名称"},{default:P(()=>[U(f,{value:_.value.customName,"onUpdate:value":t[0]||(t[0]=c=>_.value.customName=c)},null,8,["value"])]),_:1}),U(w,{label:"云端录像"},{default:P(()=>[U(b,{value:_.value.cloudRecord,"onUpdate:value":t[1]||(t[1]=c=>_.value.cloudRecord=c)},{default:P(()=>[U(l,{value:"0"},{default:P(()=>t[21]||(t[21]=[X("关闭")])),_:1}),U(l,{value:"1"},{default:P(()=>t[22]||(t[22]=[X("开启")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["form","model"])]),_:1},8,["visible"]),U(qe,{visible:L.value,hasAudio:!0,flvUrl:se.value,onCancel:t[13]||(t[13]=c=>le()),"onUpdate:visible":t[14]||(t[14]=c=>L.value=c)},{default:P(()=>[S("div",Xe,[S("div",Ye,[S("div",{class:"triangle triangle-up",onClick:t[2]||(t[2]=c=>e({upDown:1}))}),S("div",{class:"triangle triangle-down",onClick:t[3]||(t[3]=c=>e({upDown:2}))}),S("div",{class:"triangle triangle-left",onClick:t[4]||(t[4]=c=>e({leftRight:1}))}),S("div",{class:"triangle triangle-right",onClick:t[5]||(t[5]=c=>e({leftRight:2}))}),S("div",{class:"circle circle-stop",onClick:t[6]||(t[6]=c=>e({}))})]),S("div",Ze,[S("div",{class:"circle circle-plus",onClick:t[7]||(t[7]=c=>e({inOut:2}))},"+"),S("div",{class:"circle circle-minus",onClick:t[8]||(t[8]=c=>e({inOut:1}))},"-")]),S("div",Ke,[S("div",et,[t[23]||(t[23]=S("span",null,"对讲",-1)),S("div",null,[a.value=="talk"?(Y(),re(ve(pe),{key:0,class:xe("audio-icon "+n.value),onClick:t[9]||(t[9]=c=>d("talk"))},null,8,["class"])):K("",!0),a.value!="talk"?(Y(),re(ve(he),{key:1,class:"audio-icon",onClick:t[10]||(t[10]=c=>d("talk"))})):K("",!0)])]),S("div",tt,[t[24]||(t[24]=S("span",null,"广播",-1)),S("div",null,[a.value=="broadcast"?(Y(),re(ve(pe),{key:0,class:xe("audio-icon "+n.value),onClick:t[11]||(t[11]=c=>d("broadcast"))},null,8,["class"])):K("",!0),a.value!="broadcast"?(Y(),re(ve(he),{key:1,class:"audio-icon",onClick:t[12]||(t[12]=c=>d("broadcast"))})):K("",!0)])])])])]),_:1},8,["visible","flvUrl"])],64)}}}),st=je(at,[["__scopeId","data-v-a0d01bc0"]]);export{st as default};
