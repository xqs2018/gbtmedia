import{u as z,a as N}from"./system-CujKZacu.js";import{d as B,r as n,j as E,b as F,c as t,w as l,f as u,z as R,y as q,h as D,o as b,i as p,_ as M}from"./index-BYlyECpH.js";import"./request-xFzgdMuq.js";const $=B({__name:"UserView",setup(j){const y=[{title:"ID",dataIndex:"id",key:"id"},{title:"用户名",dataIndex:"username",key:"username"},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"更新时间",dataIndex:"updateTime",key:"updateTime"},{title:"操作",key:"action"}],m=n([]),d=n({current:1,pageSize:10,total:0,showSizeChanger:!0,showTotal:a=>`共 ${a} 条`}),i=n(!1),c=n(!1),v=n(),f=n(null),o=n({password:"",confirmPassword:""}),k={password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:async(a,e)=>{if(e!==o.value.password)throw new Error("两次输入的密码不一致")},trigger:"blur"}]},w=async()=>{i.value=!0;try{const a={pageNum:d.value.current-1,pageSize:d.value.pageSize},e=await z(a);e.code===200&&e.success&&(m.value=e.data.content.map(s=>({...s,key:s.id})),d.value.total=e.data.page.totalElements)}catch(a){console.error("获取用户列表失败:",a)}finally{i.value=!1}},C=a=>{d.value=a,w()};E(()=>{w()});const P=a=>{f.value=a,c.value=!0},h=async()=>{var a;try{await((a=v.value)==null?void 0:a.validate());const e={username:f.value.username,password:o.value.password},s=await N(e);s.code===200&&s.success?(p.success("密码修改成功"),c.value=!1,o.value={password:"",confirmPassword:""}):p.error(s.message||"密码修改失败")}catch(e){console.error("密码修改失败:",e),p.error("密码修改失败")}},x=()=>{c.value=!1,o.value={password:"",confirmPassword:""}};return(a,e)=>{const s=u("a-button"),T=u("a-space"),I=u("a-table"),_=u("a-input-password"),g=u("a-form-item"),S=u("a-form"),U=u("a-modal");return b(),F("div",null,[t(I,{columns:y,"data-source":m.value,pagination:d.value,loading:i.value,onChange:C},{bodyCell:l(({column:r,record:V})=>[r.key==="action"?(b(),R(T,{key:0},{default:l(()=>[t(s,{type:"link",onClick:O=>P(V)},{default:l(()=>e[3]||(e[3]=[D("修改密码")])),_:2},1032,["onClick"])]),_:2},1024)):q("",!0)]),_:1},8,["data-source","pagination","loading"]),t(U,{visible:c.value,"onUpdate:visible":e[2]||(e[2]=r=>c.value=r),title:"修改密码",onOk:h,onCancel:x},{default:l(()=>[t(S,{ref_key:"passwordFormRef",ref:v,model:o.value,rules:k,layout:"vertical"},{default:l(()=>[t(g,{label:"新密码",name:"password"},{default:l(()=>[t(_,{value:o.value.password,"onUpdate:value":e[0]||(e[0]=r=>o.value.password=r),placeholder:"请输入新密码"},null,8,["value"])]),_:1}),t(g,{label:"确认密码",name:"confirmPassword"},{default:l(()=>[t(_,{value:o.value.confirmPassword,"onUpdate:value":e[1]||(e[1]=r=>o.value.confirmPassword=r),placeholder:"请再次输入新密码"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])}}}),J=M($,[["__scopeId","data-v-22feab1f"]]);export{J as default};
