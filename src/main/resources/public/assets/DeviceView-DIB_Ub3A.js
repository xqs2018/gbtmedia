import{a as L,q as H,b as K,d as Q,u as z}from"./gbt28181-C3wyvrue.js";import{d as W,r as c,j as X,b as I,e as Y,c as a,w as l,f as m,F as w,h as u,y as S,z as Z,t as C,x as ee,i as k,o as x,_ as ae}from"./index-BYlyECpH.js";import"./request-xFzgdMuq.js";const te={class:"search-form",style:{"margin-bottom":"16px"}},le=W({__name:"DeviceView",setup(ne){const V=[{title:"设备ID",dataIndex:"deviceId",key:"deviceId"},{title:"名称",dataIndex:"name",key:"name",customRender:({record:t})=>t.customName||t.name},{title:"制造厂商",dataIndex:"manufacturer",key:"manufacturer"},{title:"信令地址",key:"sipAddress"},{title:"流媒体传输模式",dataIndex:"mediaTransport",key:"mediaTransport"},{title:"状态",key:"online"},{title:"心跳时间",dataIndex:"keepaliveTime",key:"keepaliveTime"},{title:"注册时间",dataIndex:"registTime",key:"registTime"},{title:"操作",key:"action",fixed:"right",width:350}],D=c([]),i=c({current:1,pageSize:10,total:0}),N=c(!1),v=c({deviceId:"",name:"",sipIp:"",online:void 0}),P=()=>{i.value.current=1,y(i.value.current,i.value.pageSize)},h=()=>{v.value={deviceId:"",name:"",sipIp:"",online:void 0},console.log("Reset searchParams:",v.value),P()},y=async(t,e)=>{try{const o={pageNo:t-1,pageSize:e,...v.value},r=await L(o);D.value=r.data.content.map(p=>({...p,loading:!1,loading1:!1})),i.value.total=r.data.page.totalElements,i.value.current=t}catch(o){console.error("获取数据失败:",o)}finally{N.value=!1}},O=t=>{const{current:e,pageSize:o}=t;y(e,o)};X(()=>{y(i.value.current,i.value.pageSize)});const B=(t,e)=>{t.mediaTransport=e,z(t).then(o=>k.success(o.message))},R=async t=>{t.loading=!0;try{const e=await H({deviceId:t.deviceId});k.success("queryDeviceInfo");const o=await K({deviceId:t.deviceId});k.success("queryCatalog sumNum: "+o.data.sumNum+" nowNum："+o.data.nowNum)}catch(e){console.log(e)}finally{t.loading=!1}},A=async t=>{t.loading1=!0;try{const e=await Q({deviceId:t.deviceId});k.success(e.message)}catch(e){console.log(e)}finally{t.loading1=!1}await y(i.value.current,i.value.pageSize)},_=c(!1),T=c(),d=c({customName:"",maxPlayStream:void 0,maxPlaybackStream:void 0,maxDownloadStream:void 0}),J={maxPlayStream:[{required:!0,message:"请输入最大播放路数"}],maxPlaybackStream:[{required:!0,message:"请输入最大回放路数"}],maxDownloadStream:[{required:!0,message:"请输入最大下载路数"}]},F=t=>{d.value=JSON.parse(JSON.stringify(t)),_.value=!0},M=async()=>{var t;try{await((t=T.value)==null?void 0:t.validate());const e=JSON.parse(JSON.stringify(d.value)),o=await z(e);k.success(o.message),await y(i.value.current,i.value.pageSize),_.value=!1}catch(e){console.error("操作失败:",e)}},$=()=>{_.value=!1};return(t,e)=>{const o=m("a-input"),r=m("a-form-item"),p=m("a-select-option"),U=m("a-select"),g=m("a-button"),q=m("a-form"),E=m("router-link"),j=m("a-table"),b=m("a-input-number"),G=m("a-modal");return x(),I(w,null,[Y("div",te,[a(q,{layout:"inline"},{default:l(()=>[a(r,{label:"设备ID"},{default:l(()=>[a(o,{value:v.value.deviceId,"onUpdate:value":e[0]||(e[0]=n=>v.value.deviceId=n),placeholder:"请输入设备ID"},null,8,["value"])]),_:1}),a(r,{label:"设备IP"},{default:l(()=>[a(o,{value:v.value.sipIp,"onUpdate:value":e[1]||(e[1]=n=>v.value.sipIp=n),placeholder:"请输入设备IP"},null,8,["value"])]),_:1}),a(r,{label:"状态"},{default:l(()=>[a(U,{value:v.value.online,"onUpdate:value":e[2]||(e[2]=n=>v.value.online=n),placeholder:"请选择状态",allowClear:"",style:{width:"120px"},"default-value":void 0},{default:l(()=>[a(p,{value:"1"},{default:l(()=>e[7]||(e[7]=[u("在线")])),_:1}),a(p,{value:"0"},{default:l(()=>e[8]||(e[8]=[u("离线")])),_:1})]),_:1},8,["value"])]),_:1}),a(r,null,{default:l(()=>[a(g,{onClick:P},{default:l(()=>e[9]||(e[9]=[u("搜索")])),_:1}),a(g,{style:{"margin-left":"8px"},onClick:h},{default:l(()=>e[10]||(e[10]=[u("重置")])),_:1})]),_:1})]),_:1})]),a(j,{columns:V,"data-source":D.value,pagination:i.value,onChange:O,loading:N.value,scroll:{x:"max-content"}},{bodyCell:l(({column:n,record:s})=>[n.key==="sipAddress"?(x(),I(w,{key:0},[u(C(s.sipIp)+":"+C(s.sipPort),1)],64)):S("",!0),n.key==="mediaTransport"?(x(),Z(U,{key:1,ref:"select",value:s.mediaTransport,"onUpdate:value":f=>s.mediaTransport=f,style:{width:"120px"},onChange:f=>B(s,f)},{default:l(()=>[a(p,{value:"tcpPassive"},{default:l(()=>e[11]||(e[11]=[u("tcpPassive")])),_:1}),a(p,{value:"tcpActive"},{default:l(()=>e[12]||(e[12]=[u("tcpActive")])),_:1}),a(p,{value:"udp"},{default:l(()=>e[13]||(e[13]=[u("udp")])),_:1})]),_:2},1032,["value","onUpdate:value","onChange"])):S("",!0),n.key==="online"?(x(),I("span",{key:2,style:ee({color:s.online=="1"?"green":"red"})},C(s.online=="1"?"在线":"离线"),5)):S("",!0),n.key==="action"?(x(),I(w,{key:3},[a(E,{to:"/GBT28181/DeviceChannelView?deviceId="+s.deviceId,style:{"margin-right":"10px"}},{default:l(()=>e[14]||(e[14]=[u("通道")])),_:2},1032,["to"]),a(g,{onClick:f=>R(s),style:{"margin-right":"10px"},loading:s.loading},{default:l(()=>e[15]||(e[15]=[u("同步")])),_:2},1032,["onClick","loading"]),a(g,{onClick:f=>F(s),style:{"margin-right":"10px"}},{default:l(()=>e[16]||(e[16]=[u("更新")])),_:2},1032,["onClick"]),a(g,{danger:"",onClick:f=>A(s),style:{"margin-right":"10px"},loading:s.loading1},{default:l(()=>e[17]||(e[17]=[u("删除")])),_:2},1032,["onClick","loading"])],64)):S("",!0)]),_:1},8,["data-source","pagination","loading"]),a(G,{visible:_.value,title:"设备信息",onOk:M,onCancel:$},{default:l(()=>[a(q,{ref_key:"formRef",ref:T,model:d.value,rules:J},{default:l(()=>[a(r,{label:"自定义名称"},{default:l(()=>[a(o,{value:d.value.customName,"onUpdate:value":e[3]||(e[3]=n=>d.value.customName=n)},null,8,["value"])]),_:1}),a(r,{label:"最大播放路数",name:"maxPlayStream"},{default:l(()=>[a(b,{value:d.value.maxPlayStream,"onUpdate:value":e[4]||(e[4]=n=>d.value.maxPlayStream=n),min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),a(r,{label:"最大回放路数",name:"maxPlaybackStream"},{default:l(()=>[a(b,{value:d.value.maxPlaybackStream,"onUpdate:value":e[5]||(e[5]=n=>d.value.maxPlaybackStream=n),min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),a(r,{label:"最大下载路数",name:"maxDownloadStream"},{default:l(()=>[a(b,{value:d.value.maxDownloadStream,"onUpdate:value":e[6]||(e[6]=n=>d.value.maxDownloadStream=n),min:1,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])],64)}}}),ue=ae(le,[["__scopeId","data-v-faf5fac5"]]);export{ue as default};
